import{k as g,j as e,p as O,x as j,I as D,M as y,h as E,r as d,b as S,i as k,D as _,S as F,y as R,s as N,m as $}from"../index.js";import{C as L,S as T}from"./index-af9073a4.js";import{S as I}from"./index-44bf2282.js";/* empty css                 */import{I as J}from"./index-0f62630d.js";import{E as M}from"./embed-ee08318b.js";import{I as P}from"./Download-4d998561.js";import"./Globe-1f44e45d.js";import"./CaretRight-731d83f5.js";function A({chat:s,onDelete:a}){var h,l;const{isOpen:i,openModal:t,closeModal:m}=g(),{isOpen:c,openModal:x,closeModal:n}=g(),{isOpen:r,openModal:o,closeModal:p}=g(),u=async()=>{if(!window.confirm(`Are you sure you want to delete this chat?

This action is irreversible.`))return!1;await M.deleteChat(s.id),a(s.id)};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"bg-transparent text-white text-opacity-80 text-sm font-medium",children:[e.jsx("td",{className:"px-6 py-4 font-medium whitespace-nowrap text-white",children:e.jsxs("a",{href:O.settings.embedSetup(),target:"_blank",rel:"noreferrer",className:"text-white flex items-center hover:underline",children:[e.jsx(J,{className:"mr-2 w-5 h-5"})," ",s.embed_config.workspace.name]})}),e.jsx("td",{onClick:o,className:"px-6 py-4 cursor-pointer transform transition-transform duration-200 hover:scale-105 hover:shadow-lg",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{children:j(s.session_id,20)}),e.jsx(v,{connection_information:s.connection_information})]})}),e.jsx("td",{onClick:t,className:"px-6 py-4 border-transparent cursor-pointer transform transition-transform duration-200 hover:scale-105 hover:shadow-lg",children:j(s.prompt,40)}),e.jsx("td",{onClick:x,className:"px-6 py-4 cursor-pointer transform transition-transform duration-200 hover:scale-105 hover:shadow-lg",children:j((h=JSON.parse(s.response))==null?void 0:h.text,40)}),e.jsx("td",{className:"px-6 py-4",children:s.createdAt}),e.jsx("td",{className:"px-6 py-4 flex items-center gap-x-6",children:e.jsx("button",{onClick:u,className:"border-none font-medium px-2 py-1 rounded-lg text-theme-text-primary hover:text-red-500",children:e.jsx(D,{className:"h-5 w-5"})})})]}),e.jsx(y,{isOpen:i,children:e.jsx(w,{text:s.prompt,closeModal:m})}),e.jsx(y,{isOpen:c,children:e.jsx(w,{text:(l=JSON.parse(s.response))==null?void 0:l.text,closeModal:n})}),e.jsx(y,{isOpen:r,children:e.jsx(w,{text:e.jsx(v,{sessionId:s.session_id,verbose:!0,connection_information:s.connection_information}),closeModal:p})})]})}const w=({text:s,closeModal:a})=>e.jsx("div",{className:"relative w-full md:max-w-2xl max-h-full",children:e.jsxs("div",{className:"w-full max-w-2xl bg-theme-bg-secondary rounded-lg shadow border-2 border-theme-modal-border overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b rounded-t border-theme-modal-border",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Viewing Text"}),e.jsx("button",{onClick:a,type:"button",className:"bg-transparent rounded-lg text-sm p-1.5 ml-auto inline-flex items-center bg-sidebar-button hover:bg-theme-modal-border hover:border-theme-modal-border hover:border-opacity-50 border-transparent border",children:e.jsx(E,{className:"text-white text-lg"})})]}),e.jsx("div",{className:"w-full p-6",children:e.jsx("pre",{className:"w-full h-[200px] py-2 px-4 whitespace-pre-line overflow-auto rounded-lg bg-zinc-900 light:bg-theme-bg-secondary border border-gray-500 text-white text-sm",children:s})})]})}),v=({sessionId:s,verbose:a=!1,connection_information:i})=>{let t={};try{t=JSON.parse(i)}catch{}return Object.keys(t).length===0?null:a?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs text-theme-text-secondary",children:["sessionID: ",s]}),t.username&&e.jsxs("p",{className:"text-xs text-theme-text-secondary",children:["username: ",t.username]}),t.ip&&e.jsxs("p",{className:"text-xs text-theme-text-secondary",children:["client ip address: ",t.ip]}),t.host&&e.jsxs("p",{className:"text-xs text-theme-text-secondary",children:["client host URL: ",t.host]})]}):e.jsxs(e.Fragment,{children:[t.username&&e.jsx("p",{className:"text-xs text-theme-text-secondary",children:t.username}),t.ip&&e.jsx("p",{className:"text-xs text-theme-text-secondary",children:t.ip}),t.host&&e.jsx("p",{className:"text-xs text-theme-text-secondary",children:t.host})]})},C={csv:{name:"CSV",mimeType:"text/csv",fileExtension:"csv",filenameFunc:()=>`anythingllm-embed-chats-${new Date().toLocaleDateString()}`},json:{name:"JSON",mimeType:"application/json",fileExtension:"json",filenameFunc:()=>`anythingllm-embed-chats-${new Date().toLocaleDateString()}`},jsonl:{name:"JSONL",mimeType:"application/jsonl",fileExtension:"jsonl",filenameFunc:()=>`anythingllm-embed-chats-${new Date().toLocaleDateString()}-lines`},jsonAlpaca:{name:"JSON (Alpaca)",mimeType:"application/json",fileExtension:"json",filenameFunc:()=>`anythingllm-embed-chats-${new Date().toLocaleDateString()}-alpaca`}};function X(){const[s,a]=d.useState(!1),i=d.useRef(),t=d.useRef(),{t:m}=S(),c=async n=>{const r=await F.exportChats(n,"embed");if(r){const{name:o,mimeType:p,fileExtension:u,filenameFunc:h}=C[n],l=new Blob([r],{type:p});R.saveAs(l,`${h()}.${u}`),N(`Embed chats exported successfully as ${o}.`,"success")}else N("Failed to export embed chats.","error")},x=()=>{a(!s)};return d.useEffect(()=>{function n(r){i.current&&!i.current.contains(r.target)&&!t.current.contains(r.target)&&a(!1)}return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[]),e.jsx(L,{children:e.jsxs("div",{className:"w-screen h-screen overflow-hidden bg-theme-bg-container flex",children:[e.jsx(T,{}),e.jsx("div",{style:{height:k?"100%":"calc(100% - 32px)"},className:"relative md:ml-[2px] md:mr-[16px] md:my-[16px] md:rounded-[16px] bg-theme-bg-secondary w-full h-full overflow-y-scroll p-4 md:p-0",children:e.jsxs("div",{className:"flex flex-col w-full px-1 md:pl-6 md:pr-[50px] md:py-6 py-16",children:[e.jsxs("div",{className:"w-full flex flex-col gap-y-1 pb-6 border-white/10 border-b-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx("p",{className:"text-lg leading-6 font-bold text-theme-text-primary",children:m("embed-chats.title")}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:t,onClick:x,className:"flex items-center gap-x-2 px-4 py-1 rounded-lg bg-primary-button hover:light:bg-theme-bg-primary hover:text-theme-text-primary text-xs font-semibold hover:bg-secondary shadow-[0_4px_14px_rgba(0,0,0,0.25)] h-[34px] w-fit",children:[e.jsx(P,{size:18,weight:"bold"}),m("embed-chats.export"),e.jsx(_,{size:18,weight:"bold"})]}),e.jsx("div",{ref:i,className:`${s?"slide-down":"slide-up hidden"} z-20 w-fit rounded-lg absolute top-full right-0 bg-secondary light:bg-theme-bg-secondary mt-2 shadow-md`,children:e.jsx("div",{className:"py-2",children:Object.entries(C).map(([n,r])=>e.jsx("button",{onClick:()=>{c(n),a(!1)},className:"w-full text-left px-4 py-2 text-white text-sm hover:bg-[#3D4147] light:hover:bg-theme-sidebar-item-hover",children:r.name},n))})})]})]}),e.jsx("p",{className:"text-xs leading-[18px] font-base text-theme-text-secondary mt-2",children:m("embed-chats.description")})]}),e.jsx("div",{className:"overflow-x-auto mt-6",children:e.jsx(z,{})})]})})]})})}function z(){const s=$(),[a,i]=d.useState(!0),[t,m]=d.useState([]),[c,x]=d.useState(Number(s.get("offset")||0)),[n,r]=d.useState(!1),{t:o}=S(),p=()=>{x(Math.max(c-1,0))},u=()=>{x(c+1)},h=l=>{m(b=>b.filter(f=>f.id!==l))};return d.useEffect(()=>{async function l(){const{chats:b,hasPages:f=!1}=await M.chats(c);m(b),r(f),i(!1)}l()},[c]),a?e.jsx(I,{height:"80vh",width:"100%",highlightColor:"var(--theme-bg-primary)",baseColor:"var(--theme-bg-secondary)",count:1,className:"w-full p-4 rounded-b-2xl rounded-tr-2xl rounded-tl-sm",containerClassName:"flex w-full"}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"w-full text-sm text-left rounded-lg min-w-[640px] border-spacing-0",children:[e.jsx("thead",{className:"text-theme-text-secondary text-xs leading-[18px] font-bold uppercase border-white/10 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 rounded-tl-lg",children:o("embed-chats.table.embed")}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:o("embed-chats.table.sender")}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:o("embed-chats.table.message")}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:o("embed-chats.table.response")}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:o("embed-chats.table.at")}),e.jsx("th",{scope:"col",className:"px-6 py-3 rounded-tr-lg",children:" "})]})}),e.jsx("tbody",{children:!!t&&t.map(l=>e.jsx(A,{chat:l,onDelete:h},l.id))})]}),e.jsxs("div",{className:"flex w-full justify-between items-center mt-6",children:[e.jsxs("button",{onClick:p,className:"px-4 py-2 rounded-lg border border-theme-text-secondary text-theme-text-secondary text-sm items-center flex gap-x-2 hover:bg-theme-text-secondary hover:text-theme-bg-secondary disabled:invisible",disabled:c===0,children:[" ",o("common.previous")]}),e.jsx("button",{onClick:u,className:"px-4 py-2 rounded-lg border border-theme-text-secondary text-theme-text-secondary text-sm items-center flex gap-x-2 hover:bg-theme-text-secondary hover:text-theme-bg-secondary disabled:invisible",disabled:!n,children:o("common.next")})]})]})}export{X as default};
