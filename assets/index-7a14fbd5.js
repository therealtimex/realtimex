import{A as w,ac as b,r as o,j as e,I as C,s as f,ad as N,h as k,ae as v,k as E,i as K,M as S,v as j}from"../index.js";import{S as I}from"./index-af9073a4.js";import{S as P}from"./index-44bf2282.js";/* empty css                 */import{C as M}from"./PlusCircle-31c6a8d8.js";import{w as B,C as T}from"./Copy-6f38e40d.js";import{w as $}from"./Plug-7d951c7d.js";import{C as L}from"./index-07eec889.js";import"./Globe-1f44e45d.js";import"./index-0f62630d.js";import"./CaretRight-731d83f5.js";const R={getAll:async()=>await fetch(`${w}/browser-extension/api-keys`,{method:"GET",headers:b()}).then(t=>t.json()).catch(t=>(console.error(t),{success:!1,error:t.message,apiKeys:[]})),generateKey:async()=>await fetch(`${w}/browser-extension/api-keys/new`,{method:"POST",headers:b()}).then(t=>t.json()).catch(t=>(console.error(t),{success:!1,error:t.message})),revoke:async t=>await fetch(`${w}/browser-extension/api-keys/${t}`,{method:"DELETE",headers:b()}).then(r=>r.json()).catch(r=>(console.error(r),{success:!1,error:r.message}))},g=R;function O({apiKey:t,removeApiKey:r,connectionString:a,isMultiUser:n}){const d=o.useRef(null),[x,c]=o.useState(!1),l=async()=>{if(!window.confirm(`Are you sure you want to revoke this browser extension API key?
After you do this it will no longer be useable.

This action is irreversible.`))return!1;(await g.revoke(t.id)).success?(r(t.id),f("Browser Extension API Key permanently revoked","info",{clear:!0})):f("Failed to revoke API Key","error",{clear:!0})},m=()=>{navigator.clipboard.writeText(a),f("Connection string copied to clipboard","success",{clear:!0}),c(!0),setTimeout(()=>c(!1),2e3)},i=()=>{window.postMessage({type:N,apiKey:a},"*"),f("Attempting to connect to browser extension...","info",{clear:!0})};return e.jsxs("tr",{ref:d,className:"bg-transparent text-white text-opacity-80 text-sm font-medium",children:[e.jsxs("td",{scope:"row",className:"px-6 py-4 whitespace-nowrap flex items-center",children:[e.jsx("span",{className:"mr-2 font-mono",children:a}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:m,"data-tooltip-id":"copy-connection-text","data-tooltip-content":"Copy connection string",className:"border-none text-theme-text-primary hover:text-theme-text-secondary transition-colors duration-200 p-1 rounded",children:x?e.jsx(B,{className:"h-5 w-5 text-green-500"}):e.jsx(T,{className:"h-5 w-5"})}),e.jsx("button",{onClick:i,"data-tooltip-id":"auto-connection","data-tooltip-content":"Automatically connect to extension",className:"border-none text-theme-text-primary hover:text-theme-text-secondary transition-colors duration-200 p-1 rounded",children:e.jsx($,{className:"h-5 w-5"})})]})]}),n&&e.jsx("td",{className:"px-6 py-4",children:t.user?t.user.username:"N/A"}),e.jsx("td",{className:"px-6 py-4",children:new Date(t.createdAt).toLocaleString()}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:l,className:"border-none font-medium px-2 py-1 rounded-lg text-theme-text-primary hover:text-red-500",children:e.jsx(C,{className:"h-5 w-5"})})})]})}function _({closeModal:t,onSuccess:r,isMultiUser:a}){const[n,d]=o.useState(null),[x,c]=o.useState(null),[l,m]=o.useState(!1),i=async p=>{c(null),p.preventDefault();const{apiKey:y,error:s}=await g.generateKey();if(y){const h=`${v()}|${y}`;d(h),r(),window.postMessage({type:N,apiKey:h},"*")}c(s)},u=()=>{if(!n)return!1;window.navigator.clipboard.writeText(n),m(!0)};return o.useEffect(()=>{function p(){if(!l)return!1;setTimeout(()=>{m(!1)},3e3)}p()},[l]),e.jsx("div",{className:"fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"relative w-full max-w-2xl bg-theme-bg-secondary rounded-lg shadow border-2 border-theme-modal-border",children:[e.jsxs("div",{className:"relative p-6 border-b rounded-t border-theme-modal-border",children:[e.jsx("div",{className:"w-full flex gap-x-2 items-center",children:e.jsx("h3",{className:"text-xl font-semibold text-white overflow-hidden overflow-ellipsis whitespace-nowrap",children:"New Browser Extension API Key"})}),e.jsx("button",{onClick:t,type:"button",className:"absolute top-4 right-4 transition-all duration-300 bg-transparent rounded-lg text-sm p-1 inline-flex items-center hover:bg-theme-modal-border hover:border-theme-modal-border hover:border-opacity-50 border-transparent border",children:e.jsx(k,{size:24,weight:"bold",className:"text-white"})})]}),e.jsx("div",{className:"px-7 py-6",children:e.jsxs("form",{onSubmit:i,children:[e.jsxs("div",{className:"space-y-6 max-h-[60vh] overflow-y-auto pr-2",children:[x&&e.jsxs("p",{className:"text-red-400 text-sm",children:["Error: ",x]}),n&&e.jsx("input",{type:"text",defaultValue:n,disabled:!0,className:"border-none bg-theme-settings-input-bg w-full text-white placeholder:text-theme-settings-input-placeholder text-sm rounded-lg block w-full p-2.5"}),a&&e.jsx("p",{className:"text-yellow-300 light:text-orange-500 text-xs md:text-sm font-semibold",children:"Warning: You are in multi-user mode, this API key will allow access to all workspaces associated with your account. Please share it cautiously."}),e.jsx("p",{className:"text-white text-opacity-60 text-xs md:text-sm",children:'After clicking "Create API Key", AnythingLLM will attempt to connect to your browser extension automatically.'}),e.jsx("p",{className:"text-white text-opacity-60 text-xs md:text-sm",children:'If you see "Connected to AnythingLLM" in the extension, the connection was successful. If not, please copy the connection string and paste it into the extension manually.'})]}),e.jsx("div",{className:"flex justify-between items-center mt-6 pt-6 border-t border-theme-modal-border",children:n?e.jsx("button",{onClick:u,type:"button",disabled:l,className:"w-full transition-all duration-300 bg-white text-black hover:opacity-60 px-4 py-2 rounded-lg text-sm cursor-pointer",children:l?"API Key Copied!":"Copy API Key"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:t,type:"button",className:"transition-all duration-300 text-white hover:bg-zinc-700 px-4 py-2 rounded-lg text-sm",children:"Cancel"}),e.jsx("button",{type:"submit",className:"transition-all duration-300 bg-white text-black hover:opacity-60 px-4 py-2 rounded-lg text-sm",children:"Create API Key"})]})})]})})]})})}function J(){const[t,r]=o.useState(!0),[a,n]=o.useState([]),[d,x]=o.useState(null),{isOpen:c,openModal:l,closeModal:m}=E(),[i,u]=o.useState(!1);o.useEffect(()=>{p()},[]);const p=async()=>{const s=await g.getAll();s.success?(n(s.apiKeys),u(s.apiKeys.some(h=>h.user!==null))):x(s.error||"Failed to fetch API keys"),r(!1)},y=s=>{n(h=>h.filter(A=>A.id!==s))};return e.jsxs("div",{className:"w-screen h-screen overflow-hidden bg-theme-bg-container flex",children:[e.jsx(I,{}),e.jsx("div",{style:{height:K?"100%":"calc(100% - 32px)"},className:"relative md:ml-[2px] md:mr-[16px] md:my-[16px] md:rounded-[16px] bg-theme-bg-secondary w-full h-full overflow-y-scroll p-4 md:p-0",children:e.jsxs("div",{className:"flex flex-col w-full px-1 md:pl-6 md:pr-[50px] md:py-6 py-16",children:[e.jsxs("div",{className:"w-full flex flex-col gap-y-1 pb-6 border-white/10 border-b-2",children:[e.jsx("div",{className:"items-center flex gap-x-4",children:e.jsx("p",{className:"text-lg leading-6 font-bold text-theme-text-primary",children:"Browser Extension API Keys"})}),e.jsx("p",{className:"text-xs leading-[18px] font-base text-theme-text-secondary mt-2",children:"Manage API keys for browser extensions connecting to your AnythingLLM instance."})]}),e.jsx("div",{className:"w-full justify-end flex",children:e.jsxs(L,{onClick:l,className:"mt-3 mr-0 mb-4 md:-mb-14 z-10",children:[e.jsx(M,{className:"h-4 w-4",weight:"bold"}),"Generate New API Key"]})}),e.jsx("div",{className:"overflow-x-auto mt-6",children:t?e.jsx(P,{height:"80vh",width:"100%",highlightColor:"var(--theme-bg-primary)",baseColor:"var(--theme-bg-secondary)",count:1,className:"w-full p-4 rounded-b-2xl rounded-tr-2xl rounded-tl-sm",containerClassName:"flex w-full"}):d?e.jsxs("div",{className:"text-red-500 mt-6",children:["Error: ",d]}):e.jsxs("table",{className:"w-full text-sm text-left rounded-lg min-w-[640px] border-spacing-0 md:mt-6 mt-0",children:[e.jsx("thead",{className:"text-theme-text-secondary text-xs leading-[18px] font-bold uppercase border-white/10 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 rounded-tl-lg",children:"Extension Connection String"}),i&&e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Created By"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Created At"}),e.jsx("th",{scope:"col",className:"px-6 py-3 rounded-tr-lg",children:"Actions"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{className:"bg-transparent text-theme-text-secondary text-sm font-medium",children:e.jsx("td",{colSpan:i?"4":"3",className:"px-6 py-4 text-center",children:"No API keys found"})}):a.map(s=>e.jsx(O,{apiKey:s,removeApiKey:y,connectionString:`${v()}|${s.key}`,isMultiUser:i},s.id))})]})})]})}),e.jsx(S,{isOpen:c,children:e.jsx(_,{closeModal:m,onSuccess:p,isMultiUser:i})}),e.jsx(j,{id:"auto-connection",place:"bottom",delayShow:300,className:"allm-tooltip !allm-text-xs"}),e.jsx(j,{id:"copy-connection-text",place:"bottom",delayShow:300,className:"allm-tooltip !allm-text-xs"})]})}export{J as default};
